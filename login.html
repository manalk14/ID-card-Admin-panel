<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login | Dashboard</title>
<link rel="stylesheet" href="fontawesome-free-7.1.0-web/fontawesome-free-7.1.0-web/css/all.min.css" />
<style>
  body {
    margin:0;
    padding:0;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#f5f6fa;
    font-family: Arial, sans-serif;
  }

  .login-container {
    background:white;
    width:100%;
    max-width:420px;
    padding:40px 35px;
    border-radius:12px;
    box-shadow:0 8px 20px rgba(0,0,0,.15);
    text-align:center;
    animation:fadeIn .5s ease;
  }

  @keyframes fadeIn {
    from{opacity:0; transform:translateY(12px);}
    to{opacity:1; transform:translateY(0);}
  }

  .login-container h2 {
    margin-bottom:6px;
    font-size:28px;
    font-weight:700;
    color:#111827;
  }

  .login-container p {
    color:#6b7280;
    font-size:14px;
    margin-bottom:30px;
  }

  .form-group {
    text-align:left;
    margin-bottom:18px;
  }

  label {
    display:block;
    font-size:14px;
    font-weight:600;
    color:#374151;
    margin-bottom:6px;
  }

  input {
    width:100%;
    padding:14px;
    border-radius:8px;
    border:1px solid #d1d5db;
    font-size:15px;
    transition:.25s;
    box-sizing: border-box;
  }

  input:focus {
    border-color:#6366f1;
    box-shadow:0 0 0 3px rgba(99,102,241,.2);
    outline:none;
  }

  button {
    width:100%;
    padding:14px;
    border:none;
    border-radius:8px;
    background:#6366f1;
    color:white;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    transition:.3s;
    margin-top:10px;
  }

  button:hover {
    background:#4f46e5;
    box-shadow:0 6px 18px rgba(99,102,241,.35);
    transform:translateY(-1px);
  }

  .pwd-toggle {
    position:relative;
  }

  .eye-btn {
    position:absolute;
    right:12px;
    top:50%;
    transform:translateY(-50%);
    cursor:pointer;
    font-size:16px;
    color:#6b7280;
    margin-top: 12px;
  }

  .footer-text {
    margin-top:18px;
    font-size:13px;
    color:#6b7280;
  }

  .error-message {
    color: #dc2626;
    font-size: 13px;
    margin-top: 5px;
    display: none;
  }

  .loader {
    display: none;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #6366f1;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
</head>

<body>

<div class="login-container">

  <h2>Welcome Back</h2>
  <p>Enter your phone number and password</p>

  <form id="loginForm">
    <div class="form-group">
      <label>User Name</label>
      <input type="text" id="username" placeholder="Enter User Name" required>
      <div class="error-message" id="userError"></div>
    </div>

    <div class="form-group pwd-toggle">
      <label>Password</label>
      <input type="password" id="password" placeholder="Enter password" required>
      <span class="eye-btn" onclick="togglePass()"><i class="fa-regular fa-eye"></i></span>
      <div class="error-message" id="passError"></div>
    </div>

    <button type="submit" id="loginButton">
      <span id="buttonText">Login</span>
      <div class="loader" id="loader"></div>
    </button>
  </form>

</div>

<script>
  // Check login status before loading any content
function checkAuth() {
    const appId = localStorage.getItem("app_id");

    // If not logged in â†’ redirect
    if (!appId || appId === "undefined" || appId === null) {
        console.warn("No app_id found. Redirecting to login page...");
        window.location.replace("login.html");
        return false;
    }

    return true;
}

  const form = document.getElementById('loginForm');
  const userError = document.getElementById('userError');
  const passError = document.getElementById('passError');
  const loginButton = document.getElementById('loginButton');
  const buttonText = document.getElementById('buttonText');
  const loader = document.getElementById('loader');

  // Toggle password visibility
  function togglePass() {
    const input = document.getElementById("password");
    const eyeIcon = document.querySelector(".eye-btn i");
    
    if (input.type === "password") {
      input.type = "text";
      eyeIcon.className = "fa-regular fa-eye-slash";
    } else {
      input.type = "password";
      eyeIcon.className = "fa-regular fa-eye";
    }
  }

  // Handle form submission
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Clear previous errors
    userError.style.display = 'none';
    passError.style.display = 'none';
    userError.textContent = '';
    passError.textContent = '';

    // Get values
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    // Validation
    let isValid = true;

    if (!username) {
      userError.textContent = 'User name is required';
      userError.style.display = 'block';
      isValid = false;
    }

    if (!password) {
      passError.textContent = 'Password is required';
      passError.style.display = 'block';
      isValid = false;
    }

    if (!isValid) return;

    // Show loading state
    loginButton.disabled = true;
    buttonText.style.display = 'none';
    loader.style.display = 'block';

    try {
      // Send login request to API
      const response = await fetch('https://www.coremicron.co.in/skynetwork/admin/action/login.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: username,  
          password: password
        })
      });

      const data = await response.json();
      console.log('API Response:', data);

      // Check if login was successful
      if (data.result == 1) {
        //Success - Store app_id in localStorage
        if (data.app_id) {
          localStorage.setItem('app_id', data.app_id);
          localStorage.setItem('username', username);
          
          // Redirect to dashboard or main page
          window.location.href = 'dealer.html'; // Change this to your actual dashboard page
        } else {
          throw new Error('No app_id received from server');
        }
      } else if (data.result == 0) {
        // Login failed
        passError.textContent = data.message || 'Invalid username or password';
        passError.style.display = 'block';
      } else {
        // Unexpected response format
        passError.textContent = 'Invalid server response';
        passError.style.display = 'block';
      }

    } catch (error) {
      console.error('Login error:', error);
      
      // Check for network errors
      if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
        passError.textContent = 'Network error. Please check your connection.';
      } else {
        passError.textContent = error.message || 'Login failed. Please try again.';
      }
      passError.style.display = 'block';
      
    } finally {
      // Reset button state
      loginButton.disabled = false;
      buttonText.style.display = 'block';
      loader.style.display = 'none';
    }
  });

  // Clear error messages when user starts typing
  document.getElementById('username').addEventListener('input', () => {
    userError.style.display = 'none';
  });

  document.getElementById('password').addEventListener('input', () => {
    passError.style.display = 'none';
  });
</script>

</body>
</html>